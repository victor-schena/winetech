function getPasteEvent(){var n=document.createElement("input"),t="onpaste";return n.setAttribute(t,""),typeof n[t]=="function"?"paste":"input"}var pasteEventName=getPasteEvent()+".mask",ua=navigator.userAgent,iPhone=/iphone/i.test(ua),android=/android/i.test(ua),caretTimeoutId;$.mask={definitions:{"9":"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},dataName:"rawMaskFn",placeholder:"_"};$.fn.extend({caret:function(n,t){var i;if(this.length!==0&&!this.is(":hidden"))return typeof n=="number"?(t=typeof t=="number"?t:n,this.each(function(){this.setSelectionRange?this.setSelectionRange(n,t):this.createTextRange&&(i=this.createTextRange(),i.collapse(!0),i.moveEnd("character",t),i.moveStart("character",n),i.select())})):(this[0].setSelectionRange?(n=this[0].selectionStart,t=this[0].selectionEnd):document.selection&&document.selection.createRange&&(i=document.selection.createRange(),n=0-i.duplicate().moveStart("character",-1e5),t=n+i.text.length),{begin:n,end:t})},unmask:function(){return this.trigger("unmask")},mask:function(n,t){var o,e,i,u,f,r;return!n&&this.length>0?(o=$(this[0]),o.data($.mask.dataName)()):(t=$.extend({placeholder:$.mask.placeholder,completed:null},t),e=$.mask.definitions,i=[],u=r=n.length,f=null,$.each(n.split(""),function(n,t){t=="?"?(r--,u=n):e[t]?(i.push(new RegExp(e[t])),f===null&&(f=i.length-1)):i.push(null)}),this.trigger("unmask").each(function(){function h(n){while(++n<r&&!i[n]);return n}function p(n){while(--n>=0&&!i[n]);return n}function y(n,u){var l,e;if(!(n<0)){for(l=n,e=h(u);l<r;l++)if(i[l]){if(e<r&&i[l].test(s[e]))s[l]=s[e],s[e]=t.placeholder;else break;e=h(e)}c();o.caret(Math.max(f,n))}}function w(n){for(var e,o,u=n,f=t.placeholder;u<r;u++)if(i[u])if(e=h(u),o=s[u],s[u]=f,e<r&&i[e].test(o))f=o;else break}function b(n){var r=n.which,u,i,t;r===8||r===46||iPhone&&r===127?(u=o.caret(),i=u.begin,t=u.end,t-i==0&&(i=r!==46?p(i):t=h(i-1),t=r===46?h(t):t),v(i,t),y(i,t-1),n.preventDefault()):r==27&&(o.val(a),o.caret(0,l()),n.preventDefault())}function k(n){var l=n.which,u=o.caret(),f,a,e;n.ctrlKey||n.altKey||n.metaKey||l<32||l&&(u.end-u.begin!=0&&(v(u.begin,u.end),y(u.begin,u.end-1)),f=h(u.begin-1),f<r&&(a=String.fromCharCode(l),i[f].test(a)&&(w(f),s[f]=a,c(),e=h(f),android?setTimeout($.proxy($.fn.caret,o,e),0):o.caret(e),t.completed&&e>=r&&t.completed.call(o))),n.preventDefault())}function v(n,u){for(var f=n;f<u&&f<r;f++)i[f]&&(s[f]=t.placeholder)}function c(){o.val(s.join(""))}function l(n){var h=o.val(),l=-1,e,a;for(e=0,pos=0;e<r;e++)if(i[e]){for(s[e]=t.placeholder;pos++<h.length;)if(a=h.charAt(pos-1),i[e].test(a)){s[e]=a;l=e;break}if(pos>h.length)break}else s[e]===h.charAt(pos)&&e!==u&&(pos++,l=e);return n?c():l+1<u?(o.val(""),v(0,r)):(c(),o.val(o.val().substring(0,l+1))),u?e:f}var o=$(this),s=$.map(n.split(""),function(n){if(n!="?")return e[n]?t.placeholder:n}),a=o.val();o.data($.mask.dataName,function(){return $.map(s,function(n,r){return i[r]&&n!=t.placeholder?n:null}).join("")});o.attr("readonly")||o.one("unmask",function(){o.unbind(".mask").removeData($.mask.dataName)}).bind("focus.mask",function(){clearTimeout(caretTimeoutId);var t;a=o.val();t=l();caretTimeoutId=setTimeout(function(){c();t==n.length?o.caret(0,t):o.caret(t)},10)}).bind("blur.mask",function(){l();o.val()!=a&&o.change()}).bind("keydown.mask",b).bind("keypress.mask",k).bind(pasteEventName,function(){setTimeout(function(){var n=l(!0);o.caret(n);t.completed&&n==o.val().length&&t.completed.call(o)},0)});l()}))}});